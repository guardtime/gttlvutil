#
# GUARDTIME CONFIDENTIAL
#
# Copyright (C) [2016] Guardtime, Inc
# All Rights Reserved
#
# NOTICE:  All information contained herein is, and remains, the
# property of Guardtime Inc and its suppliers, if any.
# The intellectual and technical concepts contained herein are
# proprietary to Guardtime Inc and its suppliers and may be
# covered by U.S. and Foreign Patents and patents in process,
# and are protected by trade secret or copyright law.
# Dissemination of this information or reproduction of this
# material is strictly forbidden unless prior written permission
# is obtained from Guardtime Inc.
# "Guardtime" and "KSI" are trademarks or registered trademarks of
# Guardtime Inc.
#



###############################################################################
# Using converted KSI signature text file stream as input to dump. 
# Using '-P' option for printing tag names. 

gttlvundump test/resources/sig/ok-sig-2014-08-01.1.ksig.txt | gttlvdump -P
>>>  /TLV.0800.*Uni-signature PDU.*
.*TLV.0805.*Calendar auth record.*
.*TLV.10,F.*Published data.*
.*TLV.02.*Published time. 53dc2a00.*
.*TLV.04.*Published hash. 01e4fc0853cacb3c888ee4d2f843083acb1a822e60403a6af7167f70d0ca8eee61.*/
>>>= 0

###############################################################################
# Save converted KSI signature text file to a binary file. Use the binary file 
# as input to dump. Using '-P' option for printing tag names. 

gttlvundump test/resources/sig/ok-sig-2014-08-01.1.ksig.txt > test/tmp/undump_ok-sig-2014-08-01.ksig
>>>= 0

gttlvdump -P test/tmp/undump_ok-sig-2014-08-01.ksig
>>>  /TLV.0800.*Uni-signature PDU.*
.*TLV.0805.*Calendar auth record.*
.*TLV.10,F.*Published data.*
.*TLV.02.*Published time. 53dc2a00.*
.*TLV.04.*Published hash. 01e4fc0853cacb3c888ee4d2f843083acb1a822e60403a6af7167f70d0ca8eee61.*/
>>>= 0

###############################################################################
# Using stream KSI signature stream from undump, grep publication time from 
# calendar authentication record.

gttlvundump test/resources/sig/ok-sig-2014-08-01.1.ksig.txt | gttlvgrep 800.805.10.02
>>>
53dc2a00
>>>= 0

###############################################################################
# Save converted KSI signature binary file to a text file. Use stream, conterted 
# from text file, as input to dump. Using '-P' option for printing tag names. 

gttlvdump test/resources/sig/ok-sig-2014-08-01.1.ksig > test/tmp/dump_ok-sig-2014-08-01.txt
>>>= 0

gttlvundump test/tmp/dump_ok-sig-2014-08-01.txt | gttlvdump -P
>>>  /TLV.0800.*Uni-signature PDU.*
.*TLV.0805.*Calendar auth record.*
.*TLV.10,F.*Published data.*
.*TLV.02.*Published time. 53dc2a00.*
.*TLV.04.*Published hash. 01e4fc0853cacb3c888ee4d2f843083acb1a822e60403a6af7167f70d0ca8eee61.*/
>>>= 0

###############################################################################
# Using converted stream from tlvundump for tlvgreping calendar hash chain 
# publication time tlv.

gttlvundump test/resources/tlv/ok-sig-2014-04-30.1-extend_response.tlv.txt | gttlvgrep 300.302.802.01
>>>
53740380
>>>= 0

###############################################################################
# Using converted stream from tlvundump for tlvgreping calendar hash chain 
# publication time tlv (binary representarion). Stream the resulting tlv to tlvdump.

gttlvundump test/resources/tlv/ok-sig-2014-04-30.1-extend_response.tlv.txt | gttlvgrep 300.302.802.01 -re | gttlvdump
>>>
TLV[01]: 53740380
>>>= 0

###############################################################################
# Create a dummy TLV element with tag 0x0123. Tlvdump to stdout.

echo -en "\01" | gttlvwrap -t 0x0123 | gttlvdump
>>>
TLV[0123]:01
>>>= 0

###############################################################################
# Create a dummy TLV element with tag 0123. Tlvdump to stdout.

echo -en "\01" | gttlvwrap -t 0123 | gttlvdump
>>>
TLV[0123]:01
>>>= 0

###############################################################################
# Create dummy TLV element and set non-critical flag. Tlvdump to stdout.

echo -en "\01" | gttlvwrap -t 0x0123 -L | gttlvdump
>>>
TLV[0123,N]:01
>>>= 0

###############################################################################
# Create dummy TLV element and set forward flag. Tlvdump to stdout.

echo -en "\01" | gttlvwrap -t 0x0123 -F | gttlvdump
>>>
TLV[0123,F]:01
>>>= 0

###############################################################################
# Create an aggregation error response. Write the response to file. Compare the
# the result to the original tlvdumped file.

((echo -en "\x61\x6e\x6f\x6e\x00" | gttlvwrap -t 01; echo -en "\x54\xca\x47\xb5" | gttlvwrap -t 02; echo -en "\x01" | gttlvwrap -t 03) | gttlvwrap -t 01; (echo -en "" | gttlvwrap -t 01; echo -en "\x01\x03" | gttlvwrap -t 04; (echo -n "The request contained invalid payload"; echo -en "\x00") | gttlvwrap -t 05) | gttlvwrap -t 0202;(echo -en "\x01\xc4\xaa\xaf\xf7\x9b\xab\x91\x37\xd2\xc1\xd8\xc4\x3e\x4f\xcd\x09\xc3\xbc\xe2\x8e\x19\x07\x9b\xe3\x6b\xb0\xd2\x11\x86\x4e\x2a\x3e") | gttlvwrap -t 1f) | gttlvwrap -t 0200 | gttlvdump > test/tmp/wrap_dump_ok_req_err.txt
>>>
>>>= 0

gttlvdump test/resources/tlv/ok_aggr_err_response-1.tlv > test/tmp/dump_ok_aggr_err_response-1.tlv.txt
>>>
>>>= 0

diff test/tmp/wrap_dump_ok_req_err.txt test/tmp/dump_ok_aggr_err_response-1.tlv.txt
>>>
>>>= 0

###############################################################################
# Compare converted stream (dump->undump) to original binary file. Using pipe.

gttlvdump test/resources/sig/ok-sig-2014-08-01.1.ksig | gttlvundump | diff test/resources/sig/ok-sig-2014-08-01.1.ksig -
>>>
>>>= 0

###############################################################################
# Compare converted files (dump->undump) to original binary file. 
# Save intermediate outputs from dump and undump.

gttlvdump test/resources/sig/ok-sig-2014-08-01.1.ksig > test/tmp/dump_ok-sig-2014-08-01.1.txt
>>>
>>>= 0

gttlvundump test/tmp/dump_ok-sig-2014-08-01.1.txt > test/tmp/undump_ok-sig-2014-08-01.1.txt.ksig
>>>
>>>= 0

diff test/resources/sig/ok-sig-2014-08-01.1.ksig test/tmp/undump_ok-sig-2014-08-01.1.txt.ksig
>>>
>>>= 0

###############################################################################
# Compare converted stream (undump->dump) to original text file.

gttlvundump test/resources/sig/ok-sig-2014-08-01.1.ksig.txt | gttlvdump | diff test/resources/sig/ok-sig-2014-08-01.1.ksig.txt -
>>>
>>>= 0

###############################################################################
# Compare converted files (undump->dump) to original text file. 
# Save intermediate outputs from dump and undump.

gttlvundump test/resources/sig/ok-sig-2014-08-01.1.ksig.txt > test/tmp/undump_ok-sig-2014-08-01.1.ksig
>>>
>>>= 0

gttlvdump test/tmp/undump_ok-sig-2014-08-01.1.ksig > test/tmp/dump_ok-sig-2014-08-01.1.ksig.txt
>>>
>>>= 0

diff test/resources/sig/ok-sig-2014-08-01.1.ksig.txt test/tmp/dump_ok-sig-2014-08-01.1.ksig.txt
>>>
>>>= 0

###############################################################################
# Compare converted stream (dump->undump->dump) to text representation of the 
# original binary file.

gttlvdump test/resources/sig/ok-sig-2014-08-01.1.ksig | gttlvundump | gttlvdump | diff test/resources/sig/ok-sig-2014-08-01.1.ksig.txt -
>>>
>>>= 0

###############################################################################
# Compare converted stream (undump->dump->undump) to binary representation of 
# the original text file.

gttlvundump test/resources/sig/ok-sig-2014-08-01.1.ksig.txt | gttlvdump | gttlvundump | diff test/resources/sig/ok-sig-2014-08-01.1.ksig -
>>>
>>>= 0

###############################################################################
# Compare converted stream (undump->dump->undump) to binary representation of 
# the original text file.
# Using '-a' option forc annotating known KSI elements. Tlvundump should ignore
# the annotations.

gttlvdump -a test/resources/sig/ok-sig-2014-08-01.1.ksig | gttlvundump | gttlvdump | diff test/resources/sig/ok-sig-2014-08-01.1.ksig.txt -
>>>
>>>= 0

###############################################################################
# Create a multi response binary stream. Compare it to the original file.

gttlvundump test/resources/tlv/test2-extend_response-reqId_1.txt test/resources/tlv/test2-extend_response-reqId_2.txt | diff test/resources/tlv/test2-extend_response-multiple.tlv -
>>>
>>>= 0

###############################################################################

